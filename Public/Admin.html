<h2>Admin Dashboard</h2>

<h3>Add User/Admin</h3>
<form id="adminForm">
  <input type="text" name="username" placeholder="Username" required><br>
  <input type="password" name="password" placeholder="Password" required><br>
  <select name="role">
    <option value="user">User</option>
    <option value="admin">Admin</option>
  </select><br><br>

  <h3>Add Question</h3>
  <input type="text" name="question" placeholder="Question text"><br>
  <input type="text" name="imageUrl" placeholder="Image URL (optional)"><br><br>

  <input type="text" name="adminUsername" placeholder="Your Admin Username" required><br>
  <input type="password" name="adminPassword" placeholder="Your Admin Password" required><br><br>

  <button type="submit">Submit</button>
</form>

<h3>Quiz Results</h3>
<div id="resultsContainer"></div>

<script>
async function loadResults() {
  const res = await fetch("/results");
  const results = await res.json();
  const container = document.getElementById("resultsContainer");
  container.innerHTML = "";
  results.forEach(r => {
    const div = document.createElement("div");
    div.innerHTML = `<b>${r.username}</b> (${new Date(r.submittedAt).toLocaleString()})<br>` +
                    r.answers.map(a => `<p>${a.question}: ${a.answer}</p>`).join('');
    container.appendChild(div);
    container.appendChild(document.createElement("hr"));
  });
}

document.getElementById("adminForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));
  const res = await fetch("/admin-dashboard", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  const text = await res.text();
  alert(text);
  e.target.reset();
  loadResults();
});

loadResults();
</script>
